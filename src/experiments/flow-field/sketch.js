/**
 * Perlin Noise Flow Field Experiment
 * Particles follow a flow field generated by Perlin noise
 */

let particles = [];
let numParticles = 2000;
let noiseScale = 0.01;

function setup() {
    const canvas = createCanvas(windowWidth, windowHeight - 60);
    canvas.parent('canvas-container');

    // Use HSB color mode for rainbow effects
    colorMode(HSB, 360, 100, 100, 1);

    // Initialize particles
    for (let i = 0; i < numParticles; i++) {
        particles.push(createVector(random(width), random(height)));
    }

    background(0);
}

function draw() {
    // Create trail effect with translucent overlay
    noStroke();
    fill(0, 0, 0, 0.05);
    rect(0, 0, width, height);

    // Update and draw particles
    for (let i = 0; i < numParticles; i++) {
        let p = particles[i];

        // Get noise value based on position
        let n = noise(p.x * noiseScale, p.y * noiseScale);
        let angle = map(n, 0, 1, 0, TWO_PI * 2);

        // Create velocity vector from angle
        let v = p5.Vector.fromAngle(angle);
        v.setMag(1);

        // Move particle
        p.add(v);

        // Draw particle with color based on angle
        let hue = map(angle, 0, TWO_PI * 2, 0, 360);
        stroke(hue, 80, 100, 0.8);
        strokeWeight(2);
        point(p.x, p.y);

        // Wrap around edges
        if (!onScreen(p)) {
            p.x = random(width);
            p.y = random(height);
        }
    }
}

function onScreen(v) {
    return v.x >= 0 && v.x <= width && v.y >= 0 && v.y <= height;
}

function windowResized() {
    resizeCanvas(windowWidth, windowHeight - 60);
    background(0);
}

// Expose p5.js functions to global scope for ES module compatibility
window.setup = setup;
window.draw = draw;
window.windowResized = windowResized;
